alert tcp any any -> 10.0.2.15 5432 ( msg:"Shikata Encoder Detected - First Packet";  base64_decode:offset 76, relative; base64_data; 
pcre:"/(\xb8.{4,34}\xd9\x74\x24\xf4.{0,10}(\x59|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x40|\x41|\x42|\x43|\x45|\x46|\x47).)|(\xbd.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5a|\x5b|\x5c|\x5e|\x5f).{0,50}\x31(\x68|\x69|\x6a|\x6b|\x6d|\x6e|\x6f).)|(\xbb.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5a|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x58|\x59|\x5a|\x5b|\x5d|\x5e|\x5f).)|(\xb9.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x48|\x49|\x4a|\x4b|\x4d|\x4e|\x4f).)|(\xbf.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5a|\x5b|\x5c|\x5d|\x5e).{0,50}\x31(\x78|\x79|\x7a|\x7b|\x7d|\x7e|\x7f).)|(\xba.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x50|\x51|\x52|\x53|\x55|\x56|\x57).)|(\xd9\x74\x24\xf4.{0,30}\xb8.{4,14}(\x59|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x40|\x41|\x42|\x43|\x45|\x46|\x47).)|(\xd9\x74\x24\xf4.{0,30}\xbd.{4,14}(\x58|\x59|\x5a|\x5b|\x5c|\x5e|\x5f).{0,50}\x31(\x68|\x69|\x6a|\x6b|\x6d|\x6e|\x6f).)|(\xd9\x74\x24\xf4.{0,30}\xbb.{4,14}(\x58|\x59|\x5a|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x58|\x59|\x5a|\x5b|\x5d|\x5e|\x5f).)|(\xd9\x74\x24\xf4.{0,30}\xb9.{4,14}(\x58|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x48|\x49|\x4a|\x4b|\x4d|\x4e|\x4f).)|(\xd9\x74\x24\xf4.{0,30}\xbf.{4,14}(\x58|\x59|\x5a|\x5b|\x5c|\x5d|\x5e).{0,50}\x31(\x78|\x79|\x7a|\x7b|\x7d|\x7e|\x7f).)|(\xd9\x74\x24\xf4.{0,30}\xba.{4,14}(\x58|\x59|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x50|\x51|\x52|\x53|\x55|\x56|\x57).)/i";
sid:10000002;rev:1;classtype:shellcode-detect;)
alert tcp any any -> 10.0.2.15 5432 ( msg:"Shikata Encoder Detected - Later Packet";  base64_decode:bytes 990, relative; base64_data; 
pcre:"/(\xb8.{4,34}\xd9\x74\x24\xf4.{0,10}(\x59|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x40|\x41|\x42|\x43|\x45|\x46|\x47).)|(\xbd.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5a|\x5b|\x5c|\x5e|\x5f).{0,50}\x31(\x68|\x69|\x6a|\x6b|\x6d|\x6e|\x6f).)|(\xbb.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5a|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x58|\x59|\x5a|\x5b|\x5d|\x5e|\x5f).)|(\xb9.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x48|\x49|\x4a|\x4b|\x4d|\x4e|\x4f).)|(\xbf.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5a|\x5b|\x5c|\x5d|\x5e).{0,50}\x31(\x78|\x79|\x7a|\x7b|\x7d|\x7e|\x7f).)|(\xba.{4,34}\xd9\x74\x24\xf4.{0,10}(\x58|\x59|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x50|\x51|\x52|\x53|\x55|\x56|\x57).)|(\xd9\x74\x24\xf4.{0,30}\xb8.{4,14}(\x59|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x40|\x41|\x42|\x43|\x45|\x46|\x47).)|(\xd9\x74\x24\xf4.{0,30}\xbd.{4,14}(\x58|\x59|\x5a|\x5b|\x5c|\x5e|\x5f).{0,50}\x31(\x68|\x69|\x6a|\x6b|\x6d|\x6e|\x6f).)|(\xd9\x74\x24\xf4.{0,30}\xbb.{4,14}(\x58|\x59|\x5a|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x58|\x59|\x5a|\x5b|\x5d|\x5e|\x5f).)|(\xd9\x74\x24\xf4.{0,30}\xb9.{4,14}(\x58|\x5a|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x48|\x49|\x4a|\x4b|\x4d|\x4e|\x4f).)|(\xd9\x74\x24\xf4.{0,30}\xbf.{4,14}(\x58|\x59|\x5a|\x5b|\x5c|\x5d|\x5e).{0,50}\x31(\x78|\x79|\x7a|\x7b|\x7d|\x7e|\x7f).)|(\xd9\x74\x24\xf4.{0,30}\xba.{4,14}(\x58|\x59|\x5b|\x5c|\x5d|\x5e|\x5f).{0,50}\x31(\x50|\x51|\x52|\x53|\x55|\x56|\x57).)/i";
sid:10000003;rev:1;classtype:shellcode-detect;)